<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="CRI-O: Applying seccomp profiles from OCI registries"><title>CRI-Oï¼šåº”ç”¨æ¥è‡ª OCI æ³¨å†Œä¸­å¿ƒçš„ seccomp é…ç½®æ–‡ä»¶</title><link rel=canonical href=https://www.acgh.top/k8s/2024/03/08/cri-o-seccomp-oci-artifacts/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="CRI-Oï¼šåº”ç”¨æ¥è‡ª OCI æ³¨å†Œä¸­å¿ƒçš„ seccomp é…ç½®æ–‡ä»¶"><meta property='og:description' content="CRI-O: Applying seccomp profiles from OCI registries"><meta property='og:url' content='https://www.acgh.top/k8s/2024/03/08/cri-o-seccomp-oci-artifacts/'><meta property='og:site_name' content='Techoc`s'><meta property='og:type' content='article'><meta property='article:section' content='K8s'><meta property='article:tag' content='Kubernetes'><meta property='article:tag' content='Kubernetes blog'><meta property='article:tag' content='ç¿»è¯‘'><meta property='article:published_time' content='2024-03-08T00:23:10+08:00'><meta property='article:modified_time' content='2024-03-08T00:23:10+08:00'><meta property='og:image' content='https://s.cn.bing.net/th?id=OHR.IguazuFalls_ZH-CN4749837052_1920x1080.webp&amp;qlt=50'><meta name=twitter:title content="CRI-Oï¼šåº”ç”¨æ¥è‡ª OCI æ³¨å†Œä¸­å¿ƒçš„ seccomp é…ç½®æ–‡ä»¶"><meta name=twitter:description content="CRI-O: Applying seccomp profiles from OCI registries"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://s.cn.bing.net/th?id=OHR.IguazuFalls_ZH-CN4749837052_1920x1080.webp&amp;qlt=50'><link rel="shortcut icon" href=/favicon.png><style>:root{--article-font-family:"Maple Mono CN", var(--base-font-family)}</style><script>(function(){const e=document.createElement("link");e.href="./MapleMono-CN-Regular/result.css",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/48900433.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ’¤</span></figure><div class=site-meta><h1 class=site-name><a href=/>Techoc`s</a></h1><h2 class=site-description>ä¸å›°ã€ä¸æƒ‘ã€ä¸å¿§ã€ä¸æƒ§ã€‚</h2></div></header><ol class=menu-social><li><a href=https://github.com/techoc target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/tags/><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#cri-o-æ¥è§£å¿§>CRI-O æ¥è§£å¿§</a><ol><li><a href=#ä½¿ç”¨æ³¨é‡Šæ¥æŒ‡å®šç‰¹å®šå®¹å™¨æˆ–æ•´ä¸ª-pod>ä½¿ç”¨æ³¨é‡Šæ¥æŒ‡å®šç‰¹å®šå®¹å™¨æˆ–æ•´ä¸ª pod</a></li><li><a href=#å¯¹å®¹å™¨é•œåƒä½¿ç”¨æ³¨é‡Š>å¯¹å®¹å™¨é•œåƒä½¿ç”¨æ³¨é‡Š</a></li><li><a href=#ä½¿ç”¨-oras-æ¨é€é…ç½®æ–‡ä»¶>ä½¿ç”¨ ORAS æ¨é€é…ç½®æ–‡ä»¶</a></li></ol></li><li><a href=#å°†æ¥çš„å·¥ä½œ>å°†æ¥çš„å·¥ä½œ</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/k8s/2024/03/08/cri-o-seccomp-oci-artifacts/><img src="https://s.cn.bing.net/th?id=OHR.IguazuFalls_ZH-CN4749837052_1920x1080.webp&amp;qlt=50" loading=lazy alt="Featured image of post CRI-Oï¼šåº”ç”¨æ¥è‡ª OCI æ³¨å†Œä¸­å¿ƒçš„ seccomp é…ç½®æ–‡ä»¶"></a></div><div class=article-details><header class=article-category><a href=/categories/kubernetes/ style=background-color:#2a9d8f;color:#fff>Kubernetes</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/k8s/2024/03/08/cri-o-seccomp-oci-artifacts/>CRI-Oï¼šåº”ç”¨æ¥è‡ª OCI æ³¨å†Œä¸­å¿ƒçš„ seccomp é…ç½®æ–‡ä»¶</a></h2><h3 class=article-subtitle>CRI-O: Applying seccomp profiles from OCI registries</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024-03-08 00:23:10</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 7 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p><strong>ä½œè€…:</strong> Sascha Grunert</p><p><strong>è¯‘è€…:</strong> <a class=link href=https://github.com/techoc target=_blank rel=noopener>Rui Yang</a></p><p>Seccomp ä»£è¡¨å®‰å…¨è®¡ç®—æ¨¡å¼ï¼Œè‡ª Linux å†…æ ¸ 2.6.12 ç‰ˆæœ¬èµ·æˆä¸ºå…¶ç‰¹æ€§ã€‚å®ƒå¯ä»¥ç”¨äºæ²™ç®±åŒ–è¿›ç¨‹çš„ç‰¹æƒï¼Œé™åˆ¶å…¶ä»ç”¨æˆ·ç©ºé—´å‘å†…æ ¸å‘å‡ºçš„è°ƒç”¨ã€‚Kubernetes å…è®¸ä½ è‡ªåŠ¨åº”ç”¨åŠ è½½åˆ°èŠ‚ç‚¹ä¸Šçš„ seccomp é…ç½®æ–‡ä»¶åˆ°ä½ çš„ Pods å’Œå®¹å™¨ã€‚</p><p>ä½†æ˜¯åœ¨ Kubernetes ä¸­åˆ†å‘è¿™äº› seccomp é…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ªé‡å¤§çš„æŒ‘æˆ˜ï¼Œå› ä¸º JSON æ–‡ä»¶å¿…é¡»åœ¨æ‰€æœ‰å¯èƒ½è¿è¡Œå·¥ä½œè´Ÿè½½çš„èŠ‚ç‚¹ä¸Šå¯ç”¨ã€‚åƒ <a class=link href=https://sigs.k8s.io/security-profiles-operator target=_blank rel=noopener>Security Profiles</a> è¿™æ ·çš„é¡¹ç›®é€šè¿‡åœ¨é›†ç¾¤å†…è¿è¡Œå®ˆæŠ¤è¿›ç¨‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™è®©æˆ‘æƒ³çŸ¥é“å“ªäº›éƒ¨åˆ†å¯ä»¥ç”± <a class=link href=/docs/setup/production-environment/container-runtimes>å®¹å™¨è¿è¡Œæ—¶</a> æ¥å®Œæˆã€‚</p><p>è¿è¡Œæ—¶é€šå¸¸ä»æœ¬åœ°è·¯å¾„åº”ç”¨é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.25.3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>securityContext</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>seccompProfile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Localhost</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>localhostProfile</span><span class=p>:</span><span class=w> </span><span class=l>nginx-1.25.3.json</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>é…ç½®æ–‡ä»¶ <code>nginx-1.25.3.json</code> å¿…é¡»ä½äº kubelet çš„æ ¹ç›®å½•ä¸­ï¼Œå¹¶è¿½åŠ  <code>seccomp</code> ç›®å½•ã€‚è¿™æ„å‘³ç€é…ç½®æ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„é»˜è®¤ä½ç½®å°†æ˜¯ <code>/var/lib/kubelet/seccomp/nginx-1.25.3.json</code>ã€‚å¦‚æœé…ç½®æ–‡ä»¶ä¸å¯ç”¨ï¼Œé‚£ä¹ˆå®¹å™¨åˆ›å»ºæ—¶å®¹å™¨è¿è¡Œæ—¶ä¼šå¤±è´¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get pods
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>NAME   READY   STATUS                 RESTARTS   AGE
</span></span></span><span class=line><span class=cl><span class=go>pod    0/1     CreateContainerError   0          38s
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl describe pod/pod <span class=p>|</span> tail
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
</span></span></span><span class=line><span class=cl><span class=go>                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
</span></span></span><span class=line><span class=cl><span class=go>Events:
</span></span></span><span class=line><span class=cl><span class=go>  Type     Reason     Age                 From               Message
</span></span></span><span class=line><span class=cl><span class=go>  ----     ------     ----                ----               -------
</span></span></span><span class=line><span class=cl><span class=go>  Normal   Scheduled  117s                default-scheduler  Successfully assigned default/pod to 127.0.0.1
</span></span></span><span class=line><span class=cl><span class=go>  Normal   Pulling    117s                kubelet            Pulling image &#34;nginx:1.25.3&#34;
</span></span></span><span class=line><span class=cl><span class=go>  Normal   Pulled     111s                kubelet            Successfully pulled image &#34;nginx:1.25.3&#34; in 5.948s (5.948s including waiting)
</span></span></span><span class=line><span class=cl><span class=go>  Warning  Failed     7s (x10 over 111s)  kubelet            Error: setup seccomp: unable to load local profile &#34;/var/lib/kubelet/seccomp/nginx-1.25.3.json&#34;: open /var/lib/kubelet/seccomp/nginx-1.25.3.json: no such file or directory
</span></span></span><span class=line><span class=cl><span class=go>  Normal   Pulled     7s (x9 over 111s)   kubelet            Container image &#34;nginx:1.25.3&#34; already present on machine
</span></span></span></code></pre></td></tr></table></div></div><p>éœ€è¦æ‰‹åŠ¨åˆ†å‘<code>Localhost</code>é…ç½®æ–‡ä»¶è¿™ä¸ªä¸»è¦éšœç¢å°†å¯¼è‡´è®¸å¤šç»ˆç«¯ç”¨æˆ·é€€å›åˆ°<code>RuntimeDefault</code>ï¼Œç”šè‡³è¿è¡Œå…¶å·¥ä½œè´Ÿè½½ä¸º<code>Unconfined</code>(ç¦ç”¨ seccomp)ã€‚</p><h2 id=cri-o-æ¥è§£å¿§>CRI-O æ¥è§£å¿§</h2><p>Kubernetes å®¹å™¨è¿è¡Œæ—¶ <a class=link href=https://github.com/cri-o/cri-o target=_blank rel=noopener>CRI-O</a> é€šè¿‡è‡ªå®šä¹‰æ³¨é‡Šæä¾›å„ç§åŠŸèƒ½ã€‚v1.30 ç‰ˆæœ¬æ·»åŠ äº†å¯¹ä¸€ç»„æ–°æ³¨é‡Šçš„<a class=link href=https://github.com/cri-o/cri-o/pull/7719 target=_blank rel=noopener>æ”¯æŒ</a>ï¼Œç§°ä¸º <code>seccomp-profile.kubernetes.cri-o.io/POD</code> å’Œ <code>seccomp-profile.kubernetes.cri-o.io/&lt;CONTAINER></code>ã€‚è¿™äº›æ³¨é‡Šå…è®¸ä½ æŒ‡å®šï¼š</p><ul><li>ä¸€ä¸ªç‰¹å®šå®¹å™¨çš„ seccomp é…ç½®æ–‡ä»¶ï¼Œå½“ä½œä¸º <code>seccomp-profile.kubernetes.cri-o.io/&lt;CONTAINER></code> ä½¿ç”¨æ—¶ï¼ˆä¾‹å¦‚ï¼š<code>seccomp-profile.kubernetes.cri-o.io/webserver: 'registry.example/example/webserver:v1'</code>ï¼‰</li><li>ä¸€ä¸ª pod ä¸­æ‰€æœ‰å®¹å™¨çš„ seccomp é…ç½®æ–‡ä»¶ï¼Œå½“ä¸ä½¿ç”¨å®¹å™¨åç§°åç¼€ä½†ä½¿ç”¨ä¿ç•™åç§° <code>POD</code> æ—¶ï¼ˆä¾‹å¦‚ï¼š<code>seccomp-profile.kubernetes.cri-o.io/POD</code>ï¼‰</li><li>æ•´ä¸ªå®¹å™¨é•œåƒçš„ seccomp é…ç½®æ–‡ä»¶ï¼Œå¦‚æœé•œåƒæœ¬èº«åŒ…å«æ³¨é‡Š <code>seccomp-profile.kubernetes.cri-o.io/POD</code> æˆ– <code>seccomp-profile.kubernetes.cri-o.io/&lt;CONTAINER></code>ã€‚</li></ul><p>CRI-O åªæœ‰åœ¨è¿è¡Œæ—¶é…ç½®ä¸ºå…è®¸çš„æƒ…å†µä¸‹æ‰ä¼šéµå®ˆè¯¥æ³¨é‡Šï¼Œä»¥åŠä»¥ <code>Unconfined</code> æ–¹å¼è¿è¡Œå·¥ä½œè´Ÿè½½ã€‚æ‰€æœ‰å…¶ä»–çš„å·¥ä½œè´Ÿè½½ä»å°†
ä½¿ç”¨å…·æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„<code>securityContext</code>ä¸­çš„å€¼</p><p>ä»…ä»…ä½¿ç”¨æ³¨é‡Šå¹¶ä¸èƒ½å¾ˆå¥½åœ°è§£å†³é…ç½®æ–‡ä»¶çš„åˆ†å‘é—®é¢˜ï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥è¢«å¼•ç”¨ï¼ä¾‹å¦‚ï¼Œç°åœ¨ä½ å¯ä»¥åƒä½¿ç”¨ OCI artifacts ä¸€æ ·æŒ‡å®š seccomp é…ç½®æ–‡ä»¶ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>seccomp-profile.kubernetes.cri-o.io/POD</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/crio/seccomp:v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w> </span><span class=l>â€¦</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>é•œåƒ <code>quay.io/crio/seccomp:v2</code> åŒ…å«ä¸€ä¸ª<code>seccomp.json</code>,è¯¥æ–‡ä»¶åŒ…å«å®é™…çš„é…ç½®æ–‡ä»¶å†…å®¹ã€‚å¯ä»¥ä½¿ç”¨åƒ <a class=link href=https://oras.land target=_blank rel=noopener>ORAS</a> æˆ– <a class=link href=https://github.com/containers/skopeo target=_blank rel=noopener>Skopeo</a> è¿™æ ·çš„å·¥å…·æ¥æ£€æŸ¥é•œåƒçš„å†…å®¹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>oras pull quay.io/crio/seccomp:v2
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Downloading 92d8ebfa89aa seccomp.json
</span></span></span><span class=line><span class=cl><span class=go>Downloaded  92d8ebfa89aa seccomp.json
</span></span></span><span class=line><span class=cl><span class=go>Pulled [registry] quay.io/crio/seccomp:v2
</span></span></span><span class=line><span class=cl><span class=go>Digest: sha256:f0205dac8a24394d9ddf4e48c7ac201ca7dcfea4c554f7ca27777a7f8c43ec1b
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>jq . seccomp.json <span class=p>|</span> head
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;defaultAction&#34;: </span><span class=s2>&#34;SCMP_ACT_ERRNO&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;defaultErrnoRet&#34;: </span><span class=m>38</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;defaultErrno&#34;: </span><span class=s2>&#34;ENOSYS&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;archMap&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;architecture&#34;: </span><span class=s2>&#34;SCMP_ARCH_X86_64&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;subArchitectures&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s2>&#34;SCMP_ARCH_X86&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s2>&#34;SCMP_ARCH_X32&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Inspect the plain manifest of the image</span>
</span></span><span class=line><span class=cl>skopeo inspect --raw docker://quay.io/crio/seccomp:v2 <span class=p>|</span> jq .
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;schemaVersion&#34;: </span><span class=m>2</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;mediaType&#34;: </span><span class=s2>&#34;application/vnd.oci.image.manifest.v1+json&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s2>&#34;config&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;mediaType&#34;: </span><span class=s2>&#34;application/vnd.cncf.seccomp-profile.config.v1+json&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;digest&#34;: </span><span class=s2>&#34;sha256:ca3d163bab055381827226140568f3bef7eaac187cebd76878e0b63e9e442356&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;size&#34;: </span><span class=m>3</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s2>&#34;layers&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;mediaType&#34;: </span><span class=s2>&#34;application/vnd.oci.image.layer.v1.tar&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;digest&#34;: </span><span class=s2>&#34;sha256:92d8ebfa89aa6dd752c6443c27e412df1b568d62b4af129494d7364802b2d476&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;size&#34;: </span><span class=m>18853</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>&#34;annotations&#34;: { &#34;org.opencontainers.image.title&#34;: </span><span class=s2>&#34;seccomp.json&#34;</span><span class=w> </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;annotations&#34;: { &#34;org.opencontainers.image.created&#34;: </span><span class=s2>&#34;2024-02-26T09:03:30Z&#34;</span><span class=w> </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}<span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>é•œåƒæ¸…å•åŒ…å«å¯¹ç‰¹å®šæ‰€éœ€é…ç½®åª’ä½“ç±»å‹çš„å¼•ç”¨ï¼ˆ<code>application/vnd. cncf.seccomp-profile.config.v1+json</code>ï¼‰å’ŒæŒ‡å‘<code>seccomp.json</code>æ–‡ä»¶çš„å•ä¸ªå±‚ï¼ˆ<code>application/vnd. oi.image.layer.v1.tar</code>ï¼‰ã€‚ä½†æ˜¯ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯•ä¸€è¯•è¿™ä¸ªæ–°ç‰¹å¾ï¼</p><h3 id=ä½¿ç”¨æ³¨é‡Šæ¥æŒ‡å®šç‰¹å®šå®¹å™¨æˆ–æ•´ä¸ª-pod>ä½¿ç”¨æ³¨é‡Šæ¥æŒ‡å®šç‰¹å®šå®¹å™¨æˆ–æ•´ä¸ª pod</h3><p>CRI-O éœ€è¦é€‚å½“åœ°é…ç½®æ‰èƒ½ä½¿ç”¨è¯¥æ³¨é‡Šã€‚å¯ä»¥é€šè¿‡å°†æ³¨é‡Šæ·»åŠ åˆ°è¿è¡Œæ—¶çš„ <code>allowed_annotations</code> æ•°ç»„æ¥å®ç°ã€‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ª drop-in é…ç½®æ–‡ä»¶ <code>/etc/crio/crio.conf.d/10-crun.conf</code> æ¥å®ç°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>crio</span><span class=p>.</span><span class=nx>runtime</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>default_runtime</span> <span class=p>=</span> <span class=s2>&#34;crun&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>crio</span><span class=p>.</span><span class=nx>runtime</span><span class=p>.</span><span class=nx>runtimes</span><span class=p>.</span><span class=nx>crun</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>allowed_annotations</span> <span class=p>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;seccomp-profile.kubernetes.cri-o.io&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä»æœ€æ–°çš„<code>main</code>æäº¤ä¸­è¿è¡Œ CRI-Oã€‚å¯ä»¥é€šè¿‡ä»æºä»£ç æ„å»ºï¼Œä½¿ç”¨<a class=link href="https://github.com/cri-o/packaging?tab=readme-ov-file#using-the-static-binary-bundles-directly" target=_blank rel=noopener>é™æ€äºŒè¿›åˆ¶åŒ…</a>
æˆ–<a class=link href="https://github.com/cri-o/packaging?tab=readme-ov-file#usage" target=_blank rel=noopener>é¢„å‘å¸ƒè½¯ä»¶åŒ…</a>æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><p>ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘åœ¨æˆ‘çš„å‘½ä»¤è¡Œä¸­è¿è¡Œäº†<code>crio</code>äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨<a class=link href="https://github.com/cri-o/cri-o?tab=readme-ov-file#running-kubernetes-with-cri-o" target=_blank rel=noopener><code>local-up-cluster.sh</code></a>æ¥å¯åŠ¨å•èŠ‚ç‚¹ Kubernetes é›†ç¾¤ã€‚ç°åœ¨é›†ç¾¤å·²ç»å¯åŠ¨å¹¶è¿è¡Œï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸ªæ²¡æœ‰æ³¨é‡Šçš„ Podï¼Œä»¥<code>Unconfined</code>æ¨¡å¼è¿è¡Œ seccompï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat pod.yaml
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.25.3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>securityContext</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>seccompProfile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Unconfined</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -f pod.yaml
</span></span></code></pre></td></tr></table></div></div><p>å·¥ä½œè´Ÿè½½å·²å¯åŠ¨å¹¶è¿è¡Œï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get pods
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>NAME   READY   STATUS    RESTARTS   AGE
</span></span></span><span class=line><span class=cl><span class=go>pod    1/1     Running   0          15s
</span></span></span></code></pre></td></tr></table></div></div><p>å¹¶ä¸”å¦‚æœæˆ‘ä½¿ç”¨<a class=link href=https://sigs.k8s.io/cri-tools target=_blank rel=noopener><code>crictl</code></a>æ£€æŸ¥å®¹å™¨,åˆ™æ²¡æœ‰ seccomp é…ç½®è¢«åº”ç”¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CONTAINER_ID</span><span class=o>=</span><span class=k>$(</span>sudo crictl ps --name container -q<span class=k>)</span>
</span></span><span class=line><span class=cl>sudo crictl inspect <span class=nv>$CONTAINER_ID</span> <span class=p>|</span> jq .info.runtimeSpec.linux.seccomp
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>null
</span></span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¿®æ”¹ podï¼Œå°†é…ç½®æ–‡ä»¶<code>quay.io/crio/seccomp:v2</code>åº”ç”¨åˆ°å®¹å™¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>seccomp-profile.kubernetes.cri-o.io/container</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/crio/seccomp:v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.25.3</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æˆ‘å¿…é¡»åˆ é™¤å¹¶é‡æ–°åˆ›å»º Podï¼Œå› ä¸ºåªæœ‰é‡æ–°åˆ›å»ºæ‰ä¼šåº”ç”¨æ–°çš„ Seccomp é…ç½®æ–‡ä»¶ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl delete pod/pod
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>pod &#34;pod&#34; deleted
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -f pod.yaml
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>pod/pod created
</span></span></span></code></pre></td></tr></table></div></div><p>CRI-O æ—¥å¿—å°†è¡¨æ˜è¿è¡Œæ—¶æ‹‰å–äº†è¯¥å·¥ä»¶ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>WARN[â€¦] Allowed annotations are specified for workload [seccomp-profile.kubernetes.cri-o.io]
</span></span></span><span class=line><span class=cl><span class=go>INFO[â€¦] Found container specific seccomp profile annotation: seccomp-profile.kubernetes.cri-o.io/container=quay.io/crio/seccomp:v2  id=26ddcbe6-6efe-414a-88fd-b1ca91979e93 name=/runtime.v1.RuntimeService/CreateContainer
</span></span></span><span class=line><span class=cl><span class=go>INFO[â€¦] Pulling OCI artifact from ref: quay.io/crio/seccomp:v2  id=26ddcbe6-6efe-414a-88fd-b1ca91979e93 name=/runtime.v1.RuntimeService/CreateContainer
</span></span></span><span class=line><span class=cl><span class=go>INFO[â€¦] Retrieved OCI artifact seccomp profile of len: 18853  id=26ddcbe6-6efe-414a-88fd-b1ca91979e93 name=/runtime.v1.RuntimeService/CreateContainer
</span></span></span></code></pre></td></tr></table></div></div><p>å¹¶ä¸”å®¹å™¨æœ€ç»ˆä½¿ç”¨äº†è¿™ä¸ªé…ç½®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CONTAINER_ID</span><span class=o>=</span><span class=k>$(</span>sudo crictl ps --name container -q<span class=k>)</span>
</span></span><span class=line><span class=cl>sudo crictl inspect <span class=nv>$CONTAINER_ID</span> <span class=p>|</span> jq .info.runtimeSpec.linux.seccomp <span class=p>|</span> head
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;defaultAction&#34;: </span><span class=s2>&#34;SCMP_ACT_ERRNO&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;defaultErrnoRet&#34;: </span><span class=m>38</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;architectures&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;SCMP_ARCH_X86_64&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;SCMP_ARCH_X86&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;SCMP_ARCH_X32&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;syscalls&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¦‚æœç”¨æˆ·å°†<code>/container</code>åç¼€æ›¿æ¢ä¸ºä¿ç•™åç§°<code>/POD</code>ï¼Œåˆ™æ¯ä¸ªå®¹å™¨ä¸­çš„ç›¸åŒæ“ä½œéƒ½ä¼šç”Ÿæ•ˆï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>seccomp-profile.kubernetes.cri-o.io/POD</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/crio/seccomp:v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.25.3</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=å¯¹å®¹å™¨é•œåƒä½¿ç”¨æ³¨é‡Š>å¯¹å®¹å™¨é•œåƒä½¿ç”¨æ³¨é‡Š</h3><p>åœ¨æŸäº›å·¥ä½œè´Ÿè½½ä¸­å°† seccomp é…ç½®æ–‡ä»¶æŒ‡å®šä¸º OCI å·¥ä»¶æ˜¯ä¸€ä¸ªå¾ˆé…·çš„åŠŸèƒ½ï¼Œä½†å¤§å¤šæ•°ç»ˆç«¯ç”¨æˆ·æ›´æ„¿æ„å°† seccomp é…ç½®æ–‡ä»¶ä¸å·²å‘å¸ƒçš„å®¹å™¨é•œåƒå…³è”èµ·æ¥ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨å®¹å™¨é•œåƒæ³¨é‡Šæ¥å®ç°ï¼›è€Œä¸æ˜¯åº”ç”¨äº Kubernetes Podï¼Œè¯¥æ³¨é‡Šæ˜¯åº”ç”¨äºå®¹å™¨é•œåƒæœ¬èº«çš„ä¸€äº›å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼Œ<a class=link href=https://podman.io target=_blank rel=noopener>Podman</a> å¯ä»¥åœ¨æ„å»ºé•œåƒæ—¶ç›´æ¥æ·»åŠ é•œåƒæ³¨é‡Šï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>podman build <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --annotation seccomp-profile.kubernetes.cri-o.io<span class=o>=</span>quay.io/crio/seccomp:v2 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -t quay.io/crio/nginx-seccomp:v2 .
</span></span></code></pre></td></tr></table></div></div><p>æ¨é€çš„é•œåƒåŒ…å«äº†è¿™ä¸ªæ³¨é‡Šï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>skopeo inspect --raw docker://quay.io/crio/nginx-seccomp:v2 <span class=p>|</span>
</span></span><span class=line><span class=cl>    jq <span class=s1>&#39;.annotations.&#34;seccomp-profile.kubernetes.cri-o.io&#34;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>&#34;quay.io/crio/seccomp:v2&#34;
</span></span></span></code></pre></td></tr></table></div></div><p>å¦‚æœç°åœ¨åœ¨ä¸€ä¸ª CRI-O æµ‹è¯• Pod å®šä¹‰ä¸­ä½¿ç”¨è¯¥é•œåƒï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># no Pod annotations set</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/crio/nginx-seccomp:v2</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç„¶åï¼ŒCRI-O æ—¥å¿—å°†æ˜¾ç¤ºé•œåƒæ³¨é‡Šå·²è¢«è¯„ä¼°ï¼Œå¹¶ä¸”é…ç½®æ–‡ä»¶å·²è¢«åº”ç”¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl delete pod/pod
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>pod &#34;pod&#34; deleted
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -f pod.yaml
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>pod/pod created
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>INFO[â€¦] Found image specific seccomp profile annotation: seccomp-profile.kubernetes.cri-o.io=quay.io/crio/seccomp:v2  id=c1f22c59-e30e-4046-931d-a0c0fdc2c8b7 name=/runtime.v1.RuntimeService/CreateContainer
</span></span></span><span class=line><span class=cl><span class=go>INFO[â€¦] Pulling OCI artifact from ref: quay.io/crio/seccomp:v2  id=c1f22c59-e30e-4046-931d-a0c0fdc2c8b7 name=/runtime.v1.RuntimeService/CreateContainer
</span></span></span><span class=line><span class=cl><span class=go>INFO[â€¦] Retrieved OCI artifact seccomp profile of len: 18853  id=c1f22c59-e30e-4046-931d-a0c0fdc2c8b7 name=/runtime.v1.RuntimeService/CreateContainer
</span></span></span><span class=line><span class=cl><span class=go>INFO[â€¦] Created container 116a316cd9a11fe861dd04c43b94f45046d1ff37e2ed05a4e4194fcaab29ee63: default/pod/container  id=c1f22c59-e30e-4046-931d-a0c0fdc2c8b7 name=/runtime.v1.RuntimeService/CreateContainer
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CONTAINER_ID</span><span class=o>=</span><span class=k>$(</span>sudo crictl ps --name container -q<span class=k>)</span>
</span></span><span class=line><span class=cl>sudo crictl inspect <span class=nv>$CONTAINER_ID</span> <span class=p>|</span> jq .info.runtimeSpec.linux.seccomp <span class=p>|</span> head
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;defaultAction&#34;: </span><span class=s2>&#34;SCMP_ACT_ERRNO&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;defaultErrnoRet&#34;: </span><span class=m>38</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;architectures&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;SCMP_ARCH_X86_64&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;SCMP_ARCH_X86&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;SCMP_ARCH_X32&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;syscalls&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯¹äºå®¹å™¨é•œåƒï¼Œæ³¨é‡Š <code>seccomp-profile.kubernetes.cri-o.io</code> å°†è¢«è§†ä¸ºä¸ <code>seccomp-profile.kubernetes.cri-o.io/POD</code> ç›¸åŒï¼Œå¹¶é€‚ç”¨äºæ•´ä¸ª Podã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå½“åœ¨é•œåƒä¸Šä½¿ç”¨å®¹å™¨ç‰¹å®šçš„æ³¨é‡Šæ—¶ï¼Œæ•´ä¸ªåŠŸèƒ½ä¹Ÿä¼šèµ·ä½œç”¨ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨çš„åç§°æ˜¯ <code>container1</code>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>skopeo inspect --raw docker://quay.io/crio/nginx-seccomp:v2-container <span class=p>|</span>
</span></span><span class=line><span class=cl>    jq <span class=s1>&#39;.annotations.&#34;seccomp-profile.kubernetes.cri-o.io/container1&#34;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>&#34;quay.io/crio/seccomp:v2&#34;
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸ªæ•´ä¸ªåŠŸèƒ½çš„å¾ˆé…·ä¹‹å¤„åœ¨äºï¼Œç”¨æˆ·ç°åœ¨å¯ä»¥ä¸ºç‰¹å®šçš„å®¹å™¨é•œåƒåˆ›å»º seccomp é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨åŒä¸€ä¸ªä»“åº“ä¸­ã€‚å°†é•œåƒä¸é…ç½®æ–‡ä»¶å…³è”èµ·æ¥ä¸ºåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå†…ç»´æŠ¤å®ƒä»¬æä¾›äº†æå¤§çš„çµæ´»æ€§ã€‚</p><h3 id=ä½¿ç”¨-oras-æ¨é€é…ç½®æ–‡ä»¶>ä½¿ç”¨ ORAS æ¨é€é…ç½®æ–‡ä»¶</h3><p>å½“ä½¿ç”¨ ORAS æ—¶ï¼Œå®é™…åˆ›å»ºåŒ…å« seccomp é…ç½®æ–‡ä»¶çš„ OCI å¯¹è±¡éœ€è¦æ›´å¤šå·¥ä½œã€‚æˆ‘å¸Œæœ›åƒ Podman è¿™æ ·çš„å·¥å…·å°†æ¥ä¼šç®€åŒ–æ•´ä¸ªè¿‡ç¨‹ã€‚å½“å‰ï¼Œå®¹å™¨æ³¨å†Œè¡¨éœ€è¦æ˜¯<a class=link href=https://oras.land/docs/compatible_oci_registries/#registries-supporting-oci-artifacts target=_blank rel=noopener>OCI å…¼å®¹çš„</a>ï¼Œè¿™ä¹Ÿé€‚ç”¨äº<a class=link href=https://quay.io target=_blank rel=noopener>Quay.io</a>ã€‚CRI-O æœŸæœ› seccomp é…ç½®æ–‡ä»¶å¯¹è±¡å…·æœ‰å®¹å™¨é•œåƒåª’ä½“ç±»å‹(<code>application/vnd.cncf.seccomp-profile.config.v1+json</code>)ï¼Œè€Œ ORAS é»˜è®¤ä½¿ç”¨<code>application/vnd.oci.empty.v1+json</code>ã€‚ä¸ºäº†å®ç°æ‰€æœ‰è¿™äº›ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;{}&#34;</span> &gt; config.json
</span></span><span class=line><span class=cl>oras push <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --config config.json:application/vnd.cncf.seccomp-profile.config.v1+json <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     quay.io/crio/seccomp:v2 seccomp.json
</span></span></code></pre></td></tr></table></div></div><p>ç”Ÿæˆçš„é•œåƒåŒ…å«äº† CRI-O æ‰€æœŸæœ›çš„<code>mediaType</code>ã€‚ORAS å°†å•ä¸ªå±‚<code>seccomp.json</code>æ¨é€åˆ°æ³¨å†Œè¡¨ä¸­ã€‚é…ç½®æ–‡ä»¶çš„åç§°å¹¶ä¸å¤ªé‡è¦ã€‚CRI-O å°†é€‰æ‹©ç¬¬ä¸€ä¸ªå±‚ï¼Œå¹¶æ£€æŸ¥å…¶æ˜¯å¦å¯ä»¥ä½œä¸º seccomp é…ç½®æ–‡ä»¶ã€‚</p><h2 id=å°†æ¥çš„å·¥ä½œ>å°†æ¥çš„å·¥ä½œ</h2><p>CRI-O å†…éƒ¨ç®¡ç†çš„ OCI èµ„æºå°±åƒæ™®é€šçš„æ–‡ä»¶ä¸€æ ·ã€‚è¿™æä¾›äº†å°†å®ƒä»¬ç§»åŠ¨ã€åˆ é™¤æˆ–åœ¨ seccomp é…ç½®æ–‡ä»¶ä¹‹å¤–æä¾›å…¶ä»–æ•°æ®çš„å¥½å¤„ã€‚è¿™ä½¿å¾—åœ¨ OCI å·¥ä»¶ä¹‹ä¸Šå¯¹ CRI-O è¿›è¡Œæœªæ¥å¢å¼ºæˆä¸ºå¯èƒ½ï¼ŒåŒæ—¶ä¹Ÿè€ƒè™‘å°† seccomp é…ç½®æ–‡ä»¶å †å ä½œä¸º OCI å·¥ä»¶ä¸­çš„å¤šä¸ªå±‚çš„ä¸€éƒ¨åˆ†ã€‚å¯¹äº v1.30.x ç‰ˆæœ¬,ä»…é€‚ç”¨äº Unconfined å·¥ä½œè´Ÿè½½çš„è¿™ä¸ªé™åˆ¶,æ˜¯ CRI-O å¸Œæœ›æœªæ¥è§£å†³çš„é—®é¢˜ã€‚é€šè¿‡ä¸ç‰ºç‰²å®‰å…¨æ€§æ¥ç®€åŒ–æ•´ä½“ç”¨æˆ·ä½“éªŒä¼¼ä¹æ˜¯å®¹å™¨å·¥ä½œè´Ÿè½½ä¸­ seccomp çš„æˆåŠŸæœªæ¥çš„å…³é”®ã€‚</p><p>CRI-O çš„ç»´æŠ¤è€…å°†ä¹äºå¬å–æœ‰å…³è¿™ä¸ªæ–°åŠŸèƒ½çš„ä»»ä½•åé¦ˆæˆ–å»ºè®®ï¼æ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡åšå®¢æ–‡ç« ï¼Œæ¬¢è¿é€šè¿‡ Kubernetes çš„ <a class=link href=https://kubernetes.slack.com/messages/CAZH62UR1 target=_blank rel=noopener>Slack é¢‘é“#crio</a> æˆ–åœ¨ <a class=link href=https://github.com/cri-o/cri-o target=_blank rel=noopener>GitHub å­˜å‚¨åº“</a>ä¸­åˆ›å»ºé—®é¢˜ä¸ç»´æŠ¤è€…è”ç³»ã€‚</p><blockquote><p>åŸæ–‡åœ°å€: <a class=link href=https://kubernetes.io/blog/2024/03/07/cri-o-seccomp-oci-artifacts/ target=_blank rel=noopener>https://kubernetes.io/blog/2024/03/07/cri-o-seccomp-oci-artifacts/</a></p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/kubernetes/>Kubernetes</a>
<a href=/tags/kubernetes-blog/>Kubernetes Blog</a>
<a href=/tags/%E7%BF%BB%E8%AF%91/>ç¿»è¯‘</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/k8s/2024/03/16/kubernetes-1-30-upcoming-changes/><div class=article-image><img src="https://www.bing.com/th?id=OHR.BambooPanda_ZH-CN8455481760_1920x1080.jpg&amp;rf=LaDigue_1920x1080.jpg&amp;pid=hp" loading=lazy data-key=kubernetes-1-30-upcoming-changes data-hash="https://www.bing.com/th?id=OHR.BambooPanda_ZH-CN8455481760_1920x1080.jpg&amp;rf=LaDigue_1920x1080.jpg&amp;pid=hp"></div><div class=article-details><h2 class=article-title>Kubernetes v1.30 åˆæ¢</h2></div></a></article><article class=has-image><a href=/k8s/2024/03/06/kubernetes-separate-image-filesystem/><div class=article-image><img src=https://img.picgo.net/2024/03/05/_20240305223322f97c305c6e79f24e.jpeg loading=lazy data-key=kubernetes-separate-image-filesystem data-hash=https://img.picgo.net/2024/03/05/_20240305223322f97c305c6e79f24e.jpeg></div><div class=article-details><h2 class=article-title>é•œåƒæ–‡ä»¶ç³»ç»Ÿï¼šé…ç½® Kubernetes å°†å®¹å™¨å­˜å‚¨åœ¨å•ç‹¬çš„æ–‡ä»¶ç³»ç»Ÿä¸Š</h2></div></a></article><article class=has-image><a href=/k8s/2024/03/02/sig-cloud-provider-spotlight-2024/><div class=article-image><img src="https://www4.bing.com//th?id=OHR.LeapingSquirrel_ZH-CN9112090462_1920x1080.jpg" loading=lazy data-key=sig-cloud-provider-spotlight-2024 data-hash="https://www4.bing.com//th?id=OHR.LeapingSquirrel_ZH-CN9112090462_1920x1080.jpg"></div><div class=article-details><h2 class=article-title>èšç„¦ SIG äº‘æä¾›å•†</h2></div></a></article><article class=has-image><a href=/2025/05/load-balancing-in-kubernetes/><div class=article-image><img src="https://www4.bing.com//th?id=OHR.SongyangTeaGarden_ZH-CN4763170909_UHD.jpg" loading=lazy data-key=load-balancing-in-kubernetes data-hash="https://www4.bing.com//th?id=OHR.SongyangTeaGarden_ZH-CN4763170909_UHD.jpg"></div><div class=article-details><h2 class=article-title>Kubernetes ä¸­çš„è´Ÿè½½å‡è¡¡</h2></div></a></article><article class=has-image><a href=/k8s/2024/03/20/nodeport-hostport-hostnetwork/><div class=article-image><img src="https://s.cn.bing.net/th?id=OHR.WhiteEyes_ZH-CN1130380430_1920x1080.jpg&amp;rf=LaDigue_1920x1080.jpg&amp;pid=hp" loading=lazy data-key=nodeport-hostport-hostnetwork data-hash="https://s.cn.bing.net/th?id=OHR.WhiteEyes_ZH-CN1130380430_1920x1080.jpg&amp;rf=LaDigue_1920x1080.jpg&amp;pid=hp"></div><div class=article-details><h2 class=article-title>NodePortå’ŒHostPortä¸HostNetworkä¹‹é—´çš„åŒºåˆ«</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=techoc/blog data-repo-id=R_kgDOLbcnXg data-category=Announcements data-category-id=DIC_kwDOLbcnXs4Cdtg0 data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2025 Techoc`s</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>